<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyRadio - Painel Administrativo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .sidebar {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      z-index: 100;
      padding: 48px 0 0;
      box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
      background-color: #343a40;
      color: #fff;
    }
    .sidebar-sticky {
      position: relative;
      top: 0;
      height: calc(100vh - 48px);
      padding-top: .5rem;
      overflow-x: hidden;
      overflow-y: auto;
    }
    .sidebar .nav-link {
      font-weight: 500;
      color: rgba(255, 255, 255, .75);
    }
    .sidebar .nav-link:hover {
      color: #fff;
    }
    .sidebar .nav-link.active {
      color: #fff;
    }
    .navbar-brand {
      padding-top: .75rem;
      padding-bottom: .75rem;
      font-size: 1rem;
      background-color: rgba(0, 0, 0, .25);
      box-shadow: inset -1px 0 0 rgba(0, 0, 0, .25);
    }
    .main-content {
      margin-left: 240px;
      padding: 2rem;
    }
    .card {
      border: none;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    .card-header {
      background-color: #3f51b5;
      color: white;
      border-top-left-radius: 10px !important;
      border-top-right-radius: 10px !important;
    }
    .btn-primary {
      background-color: #3f51b5;
      border-color: #3f51b5;
    }
    .btn-primary:hover {
      background-color: #303f9f;
      border-color: #303f9f;
    }
    .login-container {
      max-width: 400px;
      margin: 100px auto;
      padding: 30px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .login-container h2 {
      color: #3f51b5;
      margin-bottom: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Seção de Login (visível inicialmente) -->
  <div class="login-container" id="loginSection">
    <h2>Painel Administrativo</h2>
    <form class="login-form" id="loginForm">
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Senha</label>
        <input type="password" class="form-control" id="password" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Entrar</button>
    </form>
  </div>

  <!-- Painel Admin (invisível inicialmente) -->
  <div id="adminPanel" style="display: none;">
    <!-- Barra lateral -->
    <nav class="sidebar" style="width: 240px;">
      <div class="position-sticky">
        <div class="navbar-brand mx-0 px-3">
          <i class="fas fa-broadcast-tower me-2"></i>MyRadio Admin
        </div>
        <hr class="text-white">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="#" id="dashboardLink">
              <i class="fas fa-home me-2"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" id="radioLink">
              <i class="fas fa-broadcast-tower me-2"></i>
              Gerenciar Rádios
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" id="musicLink">
              <i class="fas fa-music me-2"></i>
              Gerenciar Músicas
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" id="spotLink">
              <i class="fas fa-ad me-2"></i>
              Gerenciar Spots
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" id="configLink">
              <i class="fas fa-cog me-2"></i>
              Configurações
            </a>
          </li>
        </ul>
        <hr class="text-white">
        <div class="px-3 mt-5">
          <button class="btn btn-outline-light w-100" id="logoutBtn">
            <i class="fas fa-sign-out-alt me-2"></i>Sair
          </button>
        </div>
      </div>
    </nav>

    <!-- Conteúdo principal -->
    <main class="main-content">
      <!-- Dashboard -->
      <div id="dashboardSection">
        <h2 class="mb-4">Dashboard</h2>
        <div class="row">
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                Rádios
              </div>
              <div class="card-body">
                <h5 class="card-title" id="totalRadios">0</h5>
                <p class="card-text">Total de rádios</p>
                <a href="#" class="btn btn-sm btn-primary" id="btnCreateRadio">Criar nova rádio</a>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                Músicas
              </div>
              <div class="card-body">
                <h5 class="card-title" id="totalMusic">0</h5>
                <p class="card-text">Total de músicas</p>
                <a href="#" class="btn btn-sm btn-primary" id="btnUploadMusic">Upload de músicas</a>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">
                Spots
              </div>
              <div class="card-body">
                <h5 class="card-title" id="totalSpots">0</h5>
                <p class="card-text">Total de spots</p>
                <a href="#" class="btn btn-sm btn-primary" id="btnUploadSpot">Upload de spots</a>
              </div>
            </div>
          </div>
        </div>

        <div class="card mt-4">
          <div class="card-header">
            Minhas Rádios
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Músicas</th>
                    <th>Spots</th>
                    <th>Criado em</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="radioTable">
                  <!-- Dados serão carregados via JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Seções para outras funcionalidades serão adicionadas depois -->
      <div id="radioSection" style="display: none;">
        <h2 class="mb-4">Gerenciar Rádios</h2>
        <!-- Conteúdo para gerenciar rádios -->
      </div>

      <div id="musicSection" style="display: none;">
        <h2 class="mb-4">Gerenciar Músicas</h2>
        <!-- Conteúdo para gerenciar músicas -->
      </div>

      <div id="spotSection" style="display: none;">
        <h2 class="mb-4">Gerenciar Spots</h2>
        <!-- Conteúdo para gerenciar spots -->
      </div>

      <div id="configSection" style="display: none;">
        <h2 class="mb-4">Configurações</h2>
        <!-- Conteúdo para configurações -->
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Variáveis globais
    let isLoggedIn = false;
    let currentUser = null;
    let userRadios = [];
    let apiUrl = 'http://localhost:5000/api';

    // Elementos DOM
    const loginSection = document.getElementById('loginSection');
    const adminPanel = document.getElementById('adminPanel');
    const loginForm = document.getElementById('loginForm');
    const logoutBtn = document.getElementById('logoutBtn');
    
    // Seções
    const dashboardSection = document.getElementById('dashboardSection');
    const radioSection = document.getElementById('radioSection');
    const musicSection = document.getElementById('musicSection');
    const spotSection = document.getElementById('spotSection');
    const configSection = document.getElementById('configSection');
    
    // Links
    const dashboardLink = document.getElementById('dashboardLink');
    const radioLink = document.getElementById('radioLink');
    const musicLink = document.getElementById('musicLink');
    const spotLink = document.getElementById('spotLink');
    const configLink = document.getElementById('configLink');

    // Elementos de estatísticas
    const totalRadios = document.getElementById('totalRadios');
    const totalMusic = document.getElementById('totalMusic');
    const totalSpots = document.getElementById('totalSpots');
    const radioTable = document.getElementById('radioTable');

    // Verificar autenticação ao carregar
    document.addEventListener('DOMContentLoaded', () => {
      checkAuth();
      setupEventListeners();
    });

    // Configurar listeners de eventos
    function setupEventListeners() {
      // Formulário de login
      loginForm.addEventListener('submit', handleLogin);
      
      // Logout
      logoutBtn.addEventListener('click', handleLogout);
      
      // Navegação
      dashboardLink.addEventListener('click', () => showSection(dashboardSection));
      radioLink.addEventListener('click', () => showSection(radioSection));
      musicLink.addEventListener('click', () => showSection(musicSection));
      spotLink.addEventListener('click', () => showSection(spotSection));
      configLink.addEventListener('click', () => showSection(configSection));
      
      // Botões de ação
      document.getElementById('btnCreateRadio').addEventListener('click', showCreateRadioForm);
      document.getElementById('btnUploadMusic').addEventListener('click', showUploadMusicForm);
      document.getElementById('btnUploadSpot').addEventListener('click', showUploadSpotForm);
      
      // Atualizar seção ativa na navegação
      document.querySelectorAll('.sidebar .nav-link').forEach(link => {
        link.addEventListener('click', function() {
          document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
          this.classList.add('active');
        });
      });
    }

    // Verificar se há um token salvo
    function checkAuth() {
      const token = localStorage.getItem('myRadioToken');
      if (token) {
        // Validar token com o servidor
        fetch(`${apiUrl}/auth/me`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        })
        .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            throw new Error('Token inválido');
          }
        })
        .then(data => {
          if (data.success) {
            currentUser = data.user;
            isLoggedIn = true;
            showAdminPanel();
            loadDashboardData();
          }
        })
        .catch(error => {
          console.error('Erro na autenticação:', error);
          showLoginForm();
        });
      } else {
        showLoginForm();
      }
    }

    // Manipular o login
    function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      fetch(`${apiUrl}/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, password })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          localStorage.setItem('myRadioToken', data.token);
          currentUser = data.user;
          isLoggedIn = true;
          showAdminPanel();
          loadDashboardData();
        } else {
          alert(data.message || 'Erro ao fazer login');
        }
      })
      .catch(error => {
        console.error('Erro no login:', error);
        alert('Erro ao fazer login. Verifique sua conexão.');
      });
    }

    // Manipular o logout
    function handleLogout() {
      localStorage.removeItem('myRadioToken');
      isLoggedIn = false;
      currentUser = null;
      showLoginForm();
    }

    // Mostrar painel administrativo
    function showAdminPanel() {
      loginSection.style.display = 'none';
      adminPanel.style.display = 'block';
      showSection(dashboardSection);
    }

    // Mostrar formulário de login
    function showLoginForm() {
      loginSection.style.display = 'block';
      adminPanel.style.display = 'none';
    }

    // Mostrar seção específica
    function showSection(section) {
      // Esconder todas as seções
      dashboardSection.style.display = 'none';
      radioSection.style.display = 'none';
      musicSection.style.display = 'none';
      spotSection.style.display = 'none';
      configSection.style.display = 'none';
      
      // Mostrar a seção solicitada
      section.style.display = 'block';
    }

    // Carregar dados do dashboard
    function loadDashboardData() {
      const token = localStorage.getItem('myRadioToken');
      if (!token) return;
      
      // Buscar rádios do usuário
      fetch(`${apiUrl}/radios`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          userRadios = data.data;
          totalRadios.textContent = data.count;
          
          // Atualizar tabela de rádios
          updateRadioTable(userRadios);
          
          // Contar total de músicas e spots
          let musicCount = 0;
          let spotCount = 0;
          
          // Buscar músicas e spots de cada rádio
          const promises = userRadios.map(radio => {
            return Promise.all([
              fetch(`${apiUrl}/music/radio/${radio.id}`, {
                headers: { 'Authorization': `Bearer ${token}` }
              }).then(res => res.json()),
              fetch(`${apiUrl}/spots/radio/${radio.id}`, {
                headers: { 'Authorization': `Bearer ${token}` }
              }).then(res => res.json())
            ]);
          });
          
          Promise.all(promises)
            .then(results => {
              results.forEach(([musicData, spotData]) => {
                if (musicData.success) musicCount += musicData.count;
                if (spotData.success) spotCount += spotData.count;
              });
              
              totalMusic.textContent = musicCount;
              totalSpots.textContent = spotCount;
            })
            .catch(error => console.error('Erro ao buscar dados de mídia:', error));
        }
      })
      .catch(error => console.error('Erro ao buscar rádios:', error));
    }

    // Atualizar tabela de rádios
    function updateRadioTable(radios) {
      radioTable.innerHTML = '';
      
      if (radios.length === 0) {
        radioTable.innerHTML = `
          <tr>
            <td colspan="5" class="text-center">Nenhuma rádio encontrada. Crie sua primeira rádio!</td>
          </tr>
        `;
        return;
      }
      
      radios.forEach(radio => {
        const row = document.createElement('tr');
        
        // Formatar data
        const createdDate = new Date(radio.createdAt);
        const formattedDate = `${createdDate.toLocaleDateString()} ${createdDate.toLocaleTimeString()}`;
        
        row.innerHTML = `
          <td>${radio.name}</td>
          <td id="musicCount-${radio.id}">...</td>
          <td id="spotCount-${radio.id}">...</td>
          <td>${formattedDate}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1" onclick="editRadio(${radio.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteRadio(${radio.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        
        radioTable.appendChild(row);
        
        // Buscar contagens
        fetchCountsForRadio(radio.id);
      });
    }

    // Buscar contagens de músicas e spots para uma rádio
    function fetchCountsForRadio(radioId) {
      const token = localStorage.getItem('myRadioToken');
      
      // Buscar músicas
      fetch(`${apiUrl}/music/radio/${radioId}`, {
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          document.getElementById(`musicCount-${radioId}`).textContent = data.count;
        }
      })
      .catch(error => console.error(`Erro ao buscar músicas para rádio ${radioId}:`, error));
      
      // Buscar spots
      fetch(`${apiUrl}/spots/radio/${radioId}`, {
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          document.getElementById(`spotCount-${radioId}`).textContent = data.count;
        }
      })
      .catch(error => console.error(`Erro ao buscar spots para rádio ${radioId}:`, error));
    }

    // Funções para editar e excluir rádios (serão implementadas posteriormente)
    function editRadio(radioId) {
      alert(`Editar rádio ${radioId} - Funcionalidade a ser implementada`);
    }
    
    function deleteRadio(radioId) {
      if (confirm('Tem certeza que deseja excluir esta rádio? Esta ação não pode ser desfeita.')) {
        const token = localStorage.getItem('myRadioToken');
        
        fetch(`${apiUrl}/radios/${radioId}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert('Rádio excluída com sucesso!');
            loadDashboardData();
          } else {
            alert(data.message || 'Erro ao excluir rádio');
          }
        })
        .catch(error => {
          console.error('Erro ao excluir rádio:', error);
          alert('Erro ao excluir rádio. Verifique sua conexão.');
        });
      }
    }

    // Função para mostrar formulário de criação de rádio
    function showCreateRadioForm() {
      // Mostrar seção de rádios e criar formulário
      showSection(radioSection);
      
      // Limpar seção e adicionar formulário
      radioSection.innerHTML = `
        <h2 class="mb-4">Criar Nova Rádio</h2>
        <div class="card">
          <div class="card-body">
            <form id="createRadioForm">
              <div class="mb-3">
                <label for="radioName" class="form-label">Nome da Rádio</label>
                <input type="text" class="form-control" id="radioName" required>
              </div>
              <div class="mb-3">
                <label for="radioDescription" class="form-label">Descrição</label>
                <textarea class="form-control" id="radioDescription" rows="3"></textarea>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="spotInterval" class="form-label">Intervalo entre spots (segundos)</label>
                  <input type="number" class="form-control" id="spotInterval" value="180">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="musicVolume" class="form-label">Volume da música (%)</label>
                  <input type="number" class="form-control" id="musicVolume" min="0" max="100" value="70">
                </div>
                <div class="col-md-4 mb-3">
                  <label for="spotVolume" class="form-label">Volume do spot (%)</label>
                  <input type="number" class="form-control" id="spotVolume" min="0" max="100" value="100">
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Criar Rádio</button>
              <button type="button" class="btn btn-secondary" onclick="showSection(dashboardSection)">Cancelar</button>
            </form>
          </div>
        </div>
      `;
      
      // Adicionar event listener ao formulário
      document.getElementById('createRadioForm').addEventListener('submit', createRadio);
    }
    
    // Função para criar uma nova rádio
    function createRadio(e) {
      e.preventDefault();
      
      const name = document.getElementById('radioName').value;
      const description = document.getElementById('radioDescription').value;
      const spotInterval = document.getElementById('spotInterval').value;
      const musicVolume = document.getElementById('musicVolume').value;
      const spotVolume = document.getElementById('spotVolume').value;
      
      const token = localStorage.getItem('myRadioToken');
      
      fetch(`${apiUrl}/radios`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          name,
          description,
          spotInterval,
          musicVolume,
          spotVolume
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Rádio criada com sucesso!');
          showSection(dashboardSection);
          loadDashboardData();
        } else {
          alert(data.message || 'Erro ao criar rádio');
        }
      })
      .catch(error => {
        console.error('Erro ao criar rádio:', error);
        alert('Erro ao criar rádio. Verifique sua conexão.');
      });
    }
    
    // Função para mostrar formulário de upload de música
    function showUploadMusicForm() {
      // Mostrar seção de músicas e criar formulário
      showSection(musicSection);
      
      // Verificar se há rádios disponíveis
      if (!userRadios || userRadios.length === 0) {
        musicSection.innerHTML = `
          <h2 class="mb-4">Upload de Música</h2>
          <div class="alert alert-warning">
            Você precisa criar uma rádio antes de fazer upload de músicas.
            <a href="#" onclick="showCreateRadioForm()" class="alert-link">Criar uma rádio agora</a>.
          </div>
        `;
        return;
      }
      
      // Criar opções de rádio
      const radioOptions = userRadios.map(radio => 
        `<option value="${radio.id}">${radio.name}</option>`
      ).join('');
      
      // Limpar seção e adicionar formulário
      musicSection.innerHTML = `
        <h2 class="mb-4">Upload de Música</h2>
        <div class="card">
          <div class="card-body">
            <form id="uploadMusicForm" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="musicRadio" class="form-label">Selecione a Rádio</label>
                <select class="form-select" id="musicRadio" required>
                  ${radioOptions}
                </select>
              </div>
              <div class="mb-3">
                <label for="musicFile" class="form-label">Arquivo de Música</label>
                <input type="file" class="form-control" id="musicFile" required>
                <small class="text-muted">Formatos suportados: MP3, WAV, OGG (máx. 30MB)</small>
              </div>
              <div class="mb-3">
                <label for="musicTitle" class="form-label">Título</label>
                <input type="text" class="form-control" id="musicTitle">
                <small class="text-muted">Se não especificado, será usado o nome do arquivo</small>
              </div>
              <div class="mb-3">
                <label for="musicArtist" class="form-label">Artista</label>
                <input type="text" class="form-control" id="musicArtist">
              </div>
              <button type="submit" class="btn btn-primary">Enviar</button>
              <button type="button" class="btn btn-secondary" onclick="showSection(dashboardSection)">Cancelar</button>
            </form>
          </div>
        </div>
      `;
      
      // Adicionar event listener ao formulário
      document.getElementById('uploadMusicForm').addEventListener('submit', uploadMusic);
    }
    
    // Função para fazer upload de música
    function uploadMusic(e) {
      e.preventDefault();
      
      const radioId = document.getElementById('musicRadio').value;
      const musicFile = document.getElementById('musicFile').files[0];
      const title = document.getElementById('musicTitle').value;
      const artist = document.getElementById('musicArtist').value;
      
      if (!musicFile) {
        alert('Por favor, selecione um arquivo de música.');
        return;
      }
      
      const token = localStorage.getItem('myRadioToken');
      const formData = new FormData();
      formData.append('music', musicFile);
      formData.append('title', title);
      formData.append('artist', artist);
      
      console.log('Enviando arquivo de música:', musicFile.name);
      
      // Não incluir headers de Authorization ao enviar FormData
      fetch(`${apiUrl}/music/upload/${radioId}`, {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Música enviada com sucesso!');
          showSection(dashboardSection);
          loadDashboardData();
        } else {
          alert(data.message || 'Erro ao enviar música');
        }
      })
      .catch(error => {
        console.error('Erro ao enviar música:', error);
        alert('Erro ao enviar música. Verifique sua conexão.');
      });
    }
    
    // Função para mostrar formulário de upload de spot
    function showUploadSpotForm() {
      // Mostrar seção de spots e criar formulário
      showSection(spotSection);
      
      // Verificar se há rádios disponíveis
      if (!userRadios || userRadios.length === 0) {
        spotSection.innerHTML = `
          <h2 class="mb-4">Upload de Spot</h2>
          <div class="alert alert-warning">
            Você precisa criar uma rádio antes de fazer upload de spots.
            <a href="#" onclick="showCreateRadioForm()" class="alert-link">Criar uma rádio agora</a>.
          </div>
        `;
        return;
      }
      
      // Criar opções de rádio
      const radioOptions = userRadios.map(radio => 
        `<option value="${radio.id}">${radio.name}</option>`
      ).join('');
      
      // Limpar seção e adicionar formulário
      spotSection.innerHTML = `
        <h2 class="mb-4">Upload de Spot</h2>
        <div class="card">
          <div class="card-body">
            <form id="uploadSpotForm" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="spotRadio" class="form-label">Selecione a Rádio</label>
                <select class="form-select" id="spotRadio" required>
                  ${radioOptions}
                </select>
              </div>
              <div class="mb-3">
                <label for="spotFile" class="form-label">Arquivo de Spot</label>
                <input type="file" class="form-control" id="spotFile" required>
                <small class="text-muted">Formatos suportados: MP3, WAV, OGG (máx. 10MB)</small>
              </div>
              <div class="mb-3">
                <label for="spotName" class="form-label">Nome</label>
                <input type="text" class="form-control" id="spotName">
                <small class="text-muted">Se não especificado, será usado o nome do arquivo</small>
              </div>
              <div class="mb-3">
                <label for="spotDescription" class="form-label">Descrição</label>
                <textarea class="form-control" id="spotDescription" rows="2"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">Enviar</button>
              <button type="button" class="btn btn-secondary" onclick="showSection(dashboardSection)">Cancelar</button>
            </form>
          </div>
        </div>
      `;
      
      // Adicionar event listener ao formulário
      document.getElementById('uploadSpotForm').addEventListener('submit', uploadSpot);
    }
    
    // Função para fazer upload de spot
    function uploadSpot(e) {
      e.preventDefault();
      
      const radioId = document.getElementById('spotRadio').value;
      const spotFile = document.getElementById('spotFile').files[0];
      const name = document.getElementById('spotName').value;
      const description = document.getElementById('spotDescription').value;
      
      if (!spotFile) {
        alert('Por favor, selecione um arquivo de spot.');
        return;
      }
      
      const token = localStorage.getItem('myRadioToken');
      const formData = new FormData();
      formData.append('spot', spotFile);
      formData.append('name', name);
      formData.append('description', description);
      
      console.log('Enviando arquivo de spot:', spotFile.name);
      
      // Não incluir headers de Authorization ao enviar FormData
      fetch(`${apiUrl}/spots/upload/${radioId}`, {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Spot enviado com sucesso!');
          showSection(dashboardSection);
          loadDashboardData();
        } else {
          alert(data.message || 'Erro ao enviar spot');
        }
      })
      .catch(error => {
        console.error('Erro ao enviar spot:', error);
        alert('Erro ao enviar spot. Verifique sua conexão.');
      });
    }
  </script>
</body>
</html>